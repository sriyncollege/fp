<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Faculty Profile — Sri Y. N. College (Autonomous)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{font-family:"Times New Roman",serif;padding:18px;color:#000}
.page{width:850px;margin:0 auto}
.header {display:flex;align-items:center;justify-content:center;position:relative;margin-bottom:10px;}
.header img {position:absolute;left:0;height:70px;}
.header-title {text-align:center;width:100%;}
.header-title h1 {margin:0;font-size:22px;}
.header-title h2 {margin:0;font-size:18px;}
.row{display:flex;gap:12px;margin-top:12px}
.col-left{flex:1}
.col-right{width:160px;text-align:center}
input,textarea{width:100%;padding:6px;font-size:14px;box-sizing:border-box}
.photo{width:120px;height:150px;border:2px solid #000;object-fit:cover;margin-top:6px;background:#fff}
.section-title{font-weight:bold;margin-top:14px;border-bottom:1px solid #000;padding-bottom:6px}
button{padding:6px 12px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:8px;table-layout:fixed;word-wrap:break-word;}
th,td{border:1px solid #000;padding:6px;text-align:left;vertical-align:top;}
.controls{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
.small{font-size:12px;color:#333}
.status{margin-top:10px;font-weight:bold}
@media print { button{display:none} input,textarea{border:none} }
</style>
</head>
<body>
<div class="page">

  <!-- Header -->
  <div class="header">
    <img src="http://sriyncollege.org/wp-content/uploads/2025/12/logoweb-1.png" alt="College Logo">
    <div class="header-title">
      <h1>Sri Y. N. College (Autonomous)</h1>
      <h2>Faculty Profile</h2>
    </div>
  </div>

  <!-- Basic Info and Photo -->
  <div class="row">
    <div class="col-left">
      <label>Name</label><input id="name" type="text">
      <label>Designation</label><input id="designation" type="text">

      <!-- NEW -->
      <label>Department</label><input id="department" type="text">

      <!-- NEW -->
      <label>Faculty Unique ID</label><input id="fid" type="text">

      <label>Address</label><textarea id="address" rows="2"></textarea>
      <label>Mobile</label><input id="mobile" type="text">
      <label>Email</label><input id="email" type="email">
      <label>Date of Birth</label><input id="dob" type="date">
      <label>Date of Joining</label><input id="doj" type="date">
      <label>Teaching Experience</label><input id="experience" type="text" placeholder="e.g., 10 years 3 months">
    </div>
    <div class="col-right">
      <label>Photo</label>
      <input id="photoUpload" type="file" accept="image/*">
      <img id="photoPreview" class="photo" alt="">
      <div class="small">(recommended 120 × 150)</div>
    </div>
  </div>

  <!-- Sections -->
  <div class="section-title">Educational Qualifications</div>
  <table id="eduTable"><tr><th>Degree</th><th>University / Institution</th><th>Year</th><th>Delete</th></tr></table>
  <button onclick="addRow('eduTable',3)">Add Row</button>

  <div class="section-title">Career Profile</div>
  <table id="careerTable"><tr><th>Designation</th><th>Institution</th><th>Duration</th><th>Delete</th></tr></table>
  <button onclick="addRow('careerTable',3)">Add Row</button>

  <div class="section-title">Administrative Assignments</div>
  <table id="adminTable"><tr><th>Role Performed</th><th>Institution</th><th>Duration</th><th>Delete</th></tr></table>
  <button onclick="addRow('adminTable',3)">Add Row</button>

  <div class="section-title">Academic Focus</div>
  <table id="focusTable"><tr><th>Focus Area / Description</th><th>Delete</th></tr></table>
  <button onclick="addRow('focusTable',1)">Add Row</button>

  <div class="section-title">Courses Taught</div>
  <table id="coursesTable"><tr><th>Course Name</th><th>Level / Semester</th><th>Delete</th></tr></table>
  <button onclick="addRow('coursesTable',2)">Add Row</button>

  <!-- NEW SECTION -->
  <div class="section-title">Research Activities</div>
  <table id="researchTable"><tr><th>Research Topic</th><th>Description</th><th>Year</th><th>Delete</th></tr></table>
  <button onclick="addRow('researchTable',3)">Add Row</button>

  <div class="section-title">Publications — Book Chapters</div>
  <table id="pubChaptersTable"><tr><th>Title</th><th>Publisher / Book</th><th>Year</th><th>Delete</th></tr></table>
  <button onclick="addRow('pubChaptersTable',3)">Add Row</button>

  <div class="section-title">Publications — Journal Papers</div>
  <table id="pubJournalsTable"><tr><th>Title</th><th>Journal / Vol</th><th>Year</th><th>Delete</th></tr></table>
  <button onclick="addRow('pubJournalsTable',3)">Add Row</button>

  <div class="section-title">Publications — Presentations</div>
  <table id="pubPresentTable"><tr><th>Title</th><th>Conference / Event</th><th>Year</th><th>Delete</th></tr></table>
  <button onclick="addRow('pubPresentTable',3)">Add Row</button>

  <div class="section-title">Awards</div>
  <table id="awardsTable"><tr><th>Award / Distinction</th><th>Year</th><th>Delete</th></tr></table>
  <button onclick="addRow('awardsTable',2)">Add Row</button>

  <div class="section-title">Memberships / Professional Bodies</div>
  <table id="membershipsTable"><tr><th>Organisation</th><th>Role / Membership</th><th>Delete</th></tr></table>
  <button onclick="addRow('membershipsTable',2)">Add Row</button>

  <div class="section-title">Other Activities</div>
  <table id="otherTable"><tr><th>Activity</th><th>Details</th><th>Delete</th></tr></table>
  <button onclick="addRow('otherTable',2)">Add Row</button>

  <!-- Buttons -->
  <div class="controls">
    <button onclick="previewLocal()">Preview</button>
    <button onclick="submitProfile()">Submit</button>
    <button onclick="saveLocal()">Save Locally</button>
    <button onclick="loadLocal()">Load Last Saved</button>
    <button onclick="clearForm()">Clear</button>
  </div>

  <div id="status" class="status"></div>
</div>

<script>
function el(id){return document.getElementById(id);}

/* PHOTO PREVIEW */
el('photoUpload').addEventListener('change', function(e){
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader(); r.onload=()=>el('photoPreview').src=r.result;
  r.readAsDataURL(f);
});

/* ADD ROW */
function addRow(id,n){
  const t=el(id); const r=t.insertRow();
  for(let i=0;i<n;i++){ r.insertCell().innerHTML="<input>"; }
  r.insertCell().innerHTML="<button onclick='this.closest(\"tr\").remove()'>Delete</button>";
}

/* SANITIZE */
function sanitize(s){return s? String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"):"";}

/* Table to HTML */
function tableToHTML(id){
  const t=el(id);
  if(t.rows.length<=1) return "<i>No entries</i>";
  let html="<table style='width:100%;border-collapse:collapse;table-layout:fixed;word-wrap:break-word;'><tr>";
  for(let i=0;i<t.rows[0].cells.length-1;i++) html+=`<th style='border:1px solid #000;padding:6px'>${sanitize(t.rows[0].cells[i].innerText)}</th>`;
  html+="</tr>";
  for(let r=1;r<t.rows.length;r++){
    html+="<tr>";
    for(let c=0;c<t.rows[r].cells.length-1;c++){
      html+=`<td style='border:1px solid #000;padding:6px'>${sanitize(t.rows[r].cells[c].querySelector("input").value)}</td>`;
    }
    html+="</tr>";
  }
  html+="</table>"; return html;
}

function formatDateDMY(d){ if(!d) return ""; const p=d.split("-"); return `${p[2]}-${p[1]}-${p[0]}`; }

function collectBasic(){
  return{
    name:el('name').value,
    designation:el('designation').value,

    /* NEW */
    department:el('department').value,
    fid:el('fid').value,

    address:el('address').value,
    mobile:el('mobile').value,
    email:el('email').value,
    dob:formatDateDMY(el('dob').value),
    doj:formatDateDMY(el('doj').value),
    experience:el('experience').value,
    photo:el('photoPreview').src || ""
  };
}

/* COLLECT FOR SUBMIT (includes tables) */
function collect(){
  const data = collectBasic();
  data.edu = Array.from(el('eduTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.career = Array.from(el('careerTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.admin = Array.from(el('adminTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.focus = Array.from(el('focusTable').rows).slice(1).map(r=>r.cells[0].querySelector("input").value);
  data.courses = Array.from(el('coursesTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));

  /* NEW */
  data.research = Array.from(el('researchTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));

  data.pubChapters = Array.from(el('pubChaptersTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.pubJournals = Array.from(el('pubJournalsTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.pubPresent = Array.from(el('pubPresentTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.awards = Array.from(el('awardsTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.memberships = Array.from(el('membershipsTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  data.other = Array.from(el('otherTable').rows).slice(1).map(r=>Array.from(r.cells).slice(0,-1).map(c=>c.querySelector("input").value));
  return data;
}

/* PREVIEW (UPDATED ONLY FOR NEW FIELDS) */
function previewLocal(){
  const b=collectBasic();
  const photo=b.photo.includes("data:") ? `<img src="${b.photo}" style="width:120px;height:150px;border:2px solid #000;">` : "";
  const w=window.open("","_blank","width=900,height=1200");
  w.document.write(`<html><head><title>Preview</title><style>
  body{font-family:"Times New Roman";width:850px;margin:0 auto;padding:28px;}
  table{width:100%;border-collapse:collapse;margin-top:8px;table-layout:fixed;word-wrap:break-word;}
  td,th{border:1px solid #000;padding:6px;text-align:left;vertical-align:top;}
  h1,h2{text-align:center;margin:0;}
  h3{border-bottom:1px solid #000;padding-bottom:4px;margin-top:18px;}
  .info-table-container{display:flex;gap:20px;margin-top:12px;}
  .info-table{flex:1;}
  .photo-container{width:140px;text-align:center;}
  </style></head><body>

  <div style="display:flex;align-items:center;justify-content:center;position:relative;margin-bottom:10px;">
    <img src="http://sriyncollege.org/wp-content/uploads/2025/12/logoweb-1.png" style="position:absolute;left:0;height:70px;">
    <div style="text-align:center;width:100%;">
      <h1>Sri Y. N. College (Autonomous)</h1>
      <h2>Faculty Profile</h2>
    </div>
  </div>

  <div class="info-table-container">
    <table class="info-table">
      <tr><td><b>Name</b></td><td>${b.name}</td></tr>
      <tr><td><b>Designation</b></td><td>${b.designation}</td></tr>

      <!-- NEW -->
      <tr><td><b>Department</b></td><td>${b.department}</td></tr>
      <tr><td><b>Faculty Unique ID</b></td><td>${b.fid}</td></tr>

      <tr><td><b>Address</b></td><td>${b.address}</td></tr>
      <tr><td><b>Mobile</b></td><td>${b.mobile}</td></tr>
      <tr><td><b>Email</b></td><td>${b.email}</td></tr>
      <tr><td><b>DOB</b></td><td>${b.dob}</td></tr>
      <tr><td><b>DOJ</b></td><td>${b.doj}</td></tr>
      <tr><td><b>Experience</b></td><td>${b.experience}</td></tr>
    </table>
    <div class="photo-container">${photo}</div>
  </div>

  <h3>Educational Qualifications</h3>${tableToHTML("eduTable")}
  <h3>Career Profile</h3>${tableToHTML("careerTable")}
  <h3>Administrative Assignments</h3>${tableToHTML("adminTable")}
  <h3>Academic Focus</h3>${tableToHTML("focusTable")}
  <h3>Courses Taught</h3>${tableToHTML("coursesTable")}

  <!-- NEW -->
  <h3>Research Activities</h3>${tableToHTML("researchTable")}

  <h3>Publications — Book Chapters</h3>${tableToHTML("pubChaptersTable")}
  <h3>Publications — Journal Papers</h3>${tableToHTML("pubJournalsTable")}
  <h3>Publications — Presentations</h3>${tableToHTML("pubPresentTable")}
  <h3>Awards</h3>${tableToHTML("awardsTable")}
  <h3>Memberships</h3>${tableToHTML("membershipsTable")}
  <h3>Other Activities</h3>${tableToHTML("otherTable")}

  <br><button onclick="window.print()">Print</button>
  </body></html>`);
  w.document.close();
}

/* SAVE / LOAD / CLEAR */
function saveLocal(){
  localStorage.setItem("faculty_basic",JSON.stringify(collectBasic()));
  alert("Saved");
}

function loadLocal(){
  const b=JSON.parse(localStorage.getItem("faculty_basic")||"{}");
  el('name').value=b.name||""; 
  el('designation').value=b.designation||"";

  /* NEW */
  el('department').value=b.department||"";
  el('fid').value=b.fid||"";

  el('address').value=b.address||"";
  el('mobile').value=b.mobile||"";
  el('email').value=b.email||"";
  el('dob').value=b.dob?b.dob.split("-").reverse().join("-"):"";
  el('doj').value=b.doj?b.doj.split("-").reverse().join("-"):"";
  el('experience').value=b.experience||"";
  if(b.photo) el('photoPreview').src=b.photo;
  alert("Loaded");
}

function clearForm(){
  el('name').value = "";
  el('designation').value = "";

  /* NEW */
  el('department').value = "";
  el('fid').value = "";

  el('address').value = "";
  el('mobile').value = "";
  el('email').value = "";
  el('dob').value = "";
  el('doj').value = "";
  el('experience').value = "";
  el('photoPreview').src = "";
  ['eduTable','careerTable','adminTable','focusTable','coursesTable','researchTable','pubChaptersTable','pubJournalsTable','pubPresentTable','awardsTable','membershipsTable','otherTable']
    .forEach(id => { const t = el(id); while(t.rows.length > 1) t.deleteRow(1); });
  alert("Form cleared!");
}

/* SUBMIT TO GOOGLE DRIVE (UNCHANGED) */
async function submitProfile(){
  const data = collect();
  if(!data.name || !data.email){ alert("Enter Name and Email"); return; }
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwWxc0ecUUW2TxxXJrJoxhrrKyPOHSCoQcwZEQH4zn6OmkA_Ej75GfjB01UM-iJfQTsPg/exec";
  el('status').innerText = "Submitting...";
  try{
    await fetch(WEB_APP_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    el('status').style.color = "green";
    el('status').innerText = "✅ Submitted Successfully!";
    alert("✅ Submitted Successfully!");
  } catch(err){
    el('status').style.color = "red";
    el('status').innerText = "❌ Submit Failed";
    alert("❌ Submit Failed");
  }
}
</script>
</body>
</html>

